<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- 自訂css -->
    <link rel="stylesheet" href="css/bookManagement.css" />
    <link rel="stylesheet" href="css/bookManagement_AddPics.css" /> <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <title>新增商品(單筆)</title>
</head>

<body>
    <!--表單內容-->
    <main class="col-md-12" style="margin:0 auto;">
        <h1 style="display: inline;">編輯商品資訊</h1>
        <div style="position: relative; left:80em; display: inline;"><a href="">返回商品管理首頁</a></div>
        <form id=" addOneBook" role="form">
            <div class="form-row">
                <div class="col-md-4">
                    <label for="bookName" class="control-label">書名</label>
                    <input type="text" class="form-control" id="bookName" name="bookName" value='${param.bookName}' required>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-2">
                    <label for="isbn" class="control-label">ISBN</label>
                    <input id="isbn" name="isbn" type="text" class="form-control" name="isbn" value='${param.isbn}' maxlength="13">
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-3">
                    <label for="publisherName" class="control-label">出版社名稱(完整)</label>
                    <input type="text" class="form-control" id="publisherName" name="publisherName" value='${param.publisherName}' required>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-3">
                    <label for="author" class="control-label">作者</label>
                    <input type="text" class="form-control" id="author" name="author" value='${param.author}' required>
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-4">
                    <label for="bookNameOriginal" class="control-label">書名原文</label>
                    <input type="text" class="form-control" id="bookNameOriginal" name="bookNameOriginal" value='${param.bookNameOriginal}'>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-1">
                    <label for="listPrice" class="control-label">定價</label>
                    <input type="text" class="form-control" id="listPrice" name="listPrice" value='${param.listPrice}' required>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-1">
                    <label for="salePrice" class="control-label">預設售價</label>
                    <input type="text" class="form-control" id="salePrice" name="salePrice" value='${param.salePrice}' required>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-1">
                    <label for="bookBP" class="control-label">紅利點數</label>
                    <input type="text" class="form-control" id="bookBP" name="bookBP" value='${param.bookBP}' required>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-1">
                    <label for="isSold">上架狀態</label>
                    <select name="isSold" id="isSold" class="form-control" name="isSold" value='${param.isSold}'>
                        <option value="1">上架</option>
                        <option value="0">下架</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <label for="publicationDate">出版日期</label>
                    <input type="date" class="form-control" id="publicationDate" name="publicationDate" value='${param.publicationDate}'>
                </div>
                <div class="col-md-1">
                    <label for="stock" class="control-label">庫存量</label>
                    <input type="text" class="form-control" id="stock" name="stock" value='${param.stock}' required>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-1">
                    <label for="safetyStock" class="control-label">安全庫存量</label>
                    <input type="text" class="form-control" id="safetyStock" name="safetyStock" value='${param.safetyStock}' required>
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-4">
                    <label for="category">商品分類</label>
                    <select name="category" id="category" class="form-control" name="category" required>
                        <option value="">請選擇商品分類</option>
                        <option value="0">華文文學,華文文學人物傳記</option>
                        <option value="1">上架</option>
                    </select>
                    <div class="help-block with-errors"></div>
                </div>
                <div class="col-md-2">
                    <label for="language">語言</label>
                    <select name="language" id="language" class="form-control" name="language">
                        <option>請選擇語言</option>
                        <option value="0">繁體中文</option>
                        <option value="1">上架</option>
                    </select>
                    <div class="help-block with-errors"></div>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-10">
                    <label for="fileInputTag">上傳商品預覽圖</label>
                    <input type="file" id="fileInputTag" style="position: relative; left:0.5em;" multiple>
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary btn" id="remove" style="position: relative; left:5em">刪除圖片</button>
                    <button class="btn btn-primary btn" id="removeAll" style="position: relative; left:5em">刪除全部</button>
                </div>
            </div>
            <div class="form-row">
                <div class="col-md-12">
                    <label>Preview:</label>
                    <div id="previewDiv"></div>
                </div>
            </div>
            <input type="submit" value="確認送出" class="btn btn-danger btn-block" />
    </main>
    </form>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function init() {
            let fileInputTag = document.getElementById("fileInputTag");
            let previewDiv = document.getElementById("previewDiv");
            let remove = document.getElementById("remove");
            let removeAll = document.getElementById("removeAll");

            // fileInputTag註冊change事件
            fileInputTag.addEventListener('change', function() {
                // files array
                let files = fileInputTag.files;
                let len = files.length;

                // 判斷files物件是否存在
                if (len > 0) {
                    // 使用let i，否則checkbox.id = i時，i永遠是len-1
                    for (let i = 0; i < len; i++) {
                        let file = files[i];
                        // 判斷file.type的型別是否包含'image'
                        if (file.type.indexOf('image') > -1) {
                            // 填入檔名
                            let reader = new FileReader();

                            // 在FileReader物件上註冊load事件
                            reader.addEventListener('load', function(e) {
                                // 新增img元素、賦予src屬性
                                let img = document.createElement('img');
                                img.setAttribute('src', e.target.result);

                                // 新增div
                                let div = document.createElement("div");
                                div.setAttribute("class", "div_img col-md-4")

                                // 新增checkbox
                                let checkbox = document.createElement('input');
                                checkbox.setAttribute('type', 'checkbox');
                                checkbox.setAttribute('class', 'checkbox');

                                div.append(checkbox);
                                div.append(img);
                                previewDiv.append(div);

                            });
                            // 使用FileReader物件上的 readAsDataURL(file) 的方法，傳入要讀取的檔案，並開始進行讀取
                            reader.readAsDataURL(file);
                        } else {
                            alert('Please upload images！');
                        }
                    }
                }
            });
        }

        // 註冊remove button
        remove.addEventListener('click', function() {
            // 重抓DOM元素
            var checkboxes = document.getElementsByClassName("checkbox");
            for (var i = (checkboxes.length - 1); i >= 0; i--) { // 逆向for-loop
                // 移除checkbox的div
                if (checkboxes[i].checked) {
                    checkboxes[i].closest('div').remove();
                }
            }
        });

        removeAll.addEventListener('click', function() {
            // 重抓DOM元素
            var checkboxes = document.getElementsByClassName("checkbox");
            for (var i = (checkboxes.length - 1); i >= 0; i--) { // 逆向for-loop
                checkboxes[i].closest('div').remove();
            }
        });

        window.onload = init;
    </script>
</body>

</html>